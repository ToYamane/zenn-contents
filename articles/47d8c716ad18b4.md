---
title: "PowerAutometeでメール転送を自動化"
emoji: "⚡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["PowerAutomate", "Excel", "Outlook", "DX", "業務効率化"]
published: true
---

PowerAutometeにて、特定のメールを自動転送する仕組みを制作しました。
業務改善の参考になれば幸いです。

## 全体像
![](</images/article1/スクリーンショット 2025-12-03 104730.png>)
今回制作した仕組みは、特定のキーワードを件名に含むメールに対し動作するようにしています。
その後、件名に同時に記載されている、転送先の会社名を抽出し、あらかじめ登録したExcelファイルと照らし合わせます。
Excelファイルには、To・Ccの複数のメールアドレスが記載されていますが、全て同時に転送できるようにします。

## ハンズオン
まずは、PowerAutometeのフローを構築していきます。
https://make.powerautomate.com/

自動化したクラウドフローから、「新しいメールが届いたとき」をトリガーに設定します。今回はOutlookを選択します。
![](</images/article1/スクリーンショット 2025-12-03 104937.png>)

詳細パラメーターから、転送したいメールの件名に含むキーワードを指定します。
環境に合わせて、特定の差出人からのメールを転送するなど、カスタムも可能です。
![](</images/article1/スクリーンショット 2025-12-03 105037.png>)

![](</images/article1/スクリーンショット 2025-12-03 105120.png>)

続いて、Excelで絞り込むための条件をメールから抽出します。
＋ボタンから、アクションを追加します。データ操作→作成を選択して下さい。
![](</images/article1/スクリーンショット 2025-12-03 105203.png>)

ここは、環境によって記述すべき内容が異なります。
私の環境では、件名に転送先の会社名が指定されているので、それを抽出する処理をしています。
どのような記述が適切か、生成AIに相談するためのプロンプトを用意したので、状況に合わせて活用してください。
注意点として、転送先の指定について、特定のフォーマットで統一されている場合のみ、データ操作のアクションで抽出が可能です。
![](</images/article1/スクリーンショット 2025-12-03 105543.png>)

:::details 🤖 生成AIへのプロンプト例
Power Automateの「作成」アクションで使用する式（Expression）を教えてください。

**やりたいこと:**
メールの件名から、特定のルールに基づいて「会社名」の部分だけを抽出したいです。

**件名のフォーマット例:**
`【対応依頼】管理番号/申込番号/株式会社〇〇(代理店コード)`


**抽出したい部分:**
上記の例でいう「株式会社〇〇」の部分

**条件:**
- `split`関数や`substring`関数など、Power Automateで使える標準関数を使用してください。
- 前後に不要なスペースが入るのを防ぐため、`trim`関数も組み合わせてください。
:::

次にExcel→表内に存在する行を一覧表示を追加します。参照すべきExcelファイルの場所を指定してください。
実際に動作させるためには、Excel上でテーブルを設定する必要があるので、後述します。
フィルタークエリにて、Excelのcompanyの列が先ほど抽出した会社名と一致するかどうか、探索しています。
![](</images/article1/スクリーンショット 2025-12-03 105610.png>)

最後に、「メールメッセージを下書きする」アクションを追加します。このアクションを追加すれば、For eachは自動で追加されます。
テスト用に誤送信防止のため下書きで設定していますが、運用が安定すれば「メールの送信」アクションに切り替えることができます。
今回は件名と本文をそのまま送信していますが、必要に応じて内容を加工することも可能です。
ここで、ToやCcをまとめて指定しています。Excelにてテーブル設定をしていないとこれらは選択できないので、この後解説します。
![](</images/article1/スクリーンショット 2025-12-03 110140.png>)

## Excelテーブル設定
範囲を指定して、スタイル→テーブルとして書式設定を行います。
![](</images/article1/スクリーンショット 2025-12-03 111147.png>)

カラム名に特に指定はありませんが、条件式と一致させる必要があるので、できるだけ分かりやすくしておきましょう。
![](</images/article1/スクリーンショット 2025-12-03 111415.png>)

正しく設定を完了したら、動的コンテンツから各カラムを選択できるようになります。
![](</images/article1/スクリーンショット 2025-12-03 140350.png>)

## まとめ
業務の定型作業を自動化したいとき、PowerAutometeは心強い味方です。
今後も実務の困りごと解決のための記事を発信していきます。